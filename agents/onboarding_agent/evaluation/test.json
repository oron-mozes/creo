[
  {
    "name": "user_provides_website_url",
    "description": "User provides a website URL, agent should search and extract business info",
    "user_message": "Yes, here is my website: https://www.almacafe.co.il/ourplaces/rehovot",
    "session_context": {},
    "expected_behavior": {
      "should_use_google_search": true,
      "should_extract_business_info": true,
      "should_generate_confirmation_block": true,
      "should_ask_for_confirmation": true
    },
    "expected_business_card": {
      "name": "Alma Cafe",
      "website": "https://www.almacafe.co.il/ourplaces/rehovot",
      "location": "Rehovot, Israel",
      "service_type": "Coffee shop"
    }
  },
  {
    "name": "user_provides_business_name_and_location",
    "description": "User provides business name and location, agent should search for details",
    "user_message": "My business is called TechStart and we're located in San Francisco",
    "session_context": {},
    "expected_behavior": {
      "should_use_google_search": true,
      "should_extract_business_info": true,
      "should_generate_confirmation_block": true,
      "should_ask_for_confirmation": true
    }
  },
  {
    "name": "user_confirms_business_details",
    "description": "User confirms the business details presented",
    "user_message": "Yes, that's correct!",
    "session_context": {
      "last_agent_message": "Business Name: Alma Cafe\\nLocation: Rehovot, Israel\\nService Type: Coffee shop\\n\\nDoes everything look correct?"
    },
    "expected_behavior": {
      "should_generate_confirmation_block": true,
      "should_thank_user": true
    }
  },
  {
    "name": "user_confirms_extracted_business_details_should_save",
    "description": "CRITICAL: After user confirms extracted business details, agent MUST call save_business_card tool",
    "user_message": "yes it does. how did you do it? that is great",
    "session_context": {
      "last_agent_message": "Great! I've found some details about your business. Can you take a quick look and tell me if everything here is correct for Alma Cafe?\\n\\nBusiness Name: Alma Cafe\\nLocation: Rehovot, Israel\\nService Type: Coffee shop\\nWebsite: https://www.almacafe.co.il/ourplaces/rehovot\\n\\nDoes that all look good?"
    },
    "expected_behavior": {
      "should_call_save_business_card_tool": true,
      "should_include_business_name_in_tool_call": true,
      "should_include_location_in_tool_call": true,
      "should_include_service_type_in_tool_call": true,
      "should_include_website_in_tool_call": true,
      "should_thank_user": true,
      "should_indicate_onboarding_complete": true
    },
    "expected_business_card": {
      "name": "Alma Cafe",
      "location": "Rehovot, Israel",
      "service_type": "Coffee shop",
      "website": "https://www.almacafe.co.il/ourplaces/rehovot"
    },
    "expected_tool_calls": [
      {
        "tool_name": "save_business_card",
        "parameters_contain": {
          "name": "Alma Cafe",
          "location": "Rehovot",
          "service_type": "Coffee shop",
          "website": "almacafe.co.il"
        }
      }
    ]
  },
  {
    "name": "new_user_with_minimal_info",
    "description": "New user provides minimal information, agent should ask for more",
    "user_message": "I have a local coffee shop",
    "session_context": {},
    "expected_behavior": {
      "should_ask_for_missing_info": true,
      "should_not_generate_confirmation_block": true
    }
  },
  {
    "name": "user_provides_social_media_handle",
    "description": "User provides Instagram handle, agent should ignore it and ask for business name (social discovery descoped)",
    "user_message": "My Instagram is @almacafe_rehovot",
    "session_context": {},
    "expected_behavior": {
      "should_ask_for_business_name": true,
      "should_not_use_google_search": true
    }
  },
  {
    "name": "vague_generic_question_no_context",
    "description": "User asks vague question with no business context clues",
    "user_message": "Can you help me with marketing?",
    "session_context": {},
    "expected_behavior": {
      "should_ask_for_business_name": true,
      "should_ask_for_industry_or_service_type": true,
      "should_not_generate_confirmation_block": true,
      "should_be_conversational_and_welcoming": true
    },
    "expected_response_contains": [
      "business",
      "brand"
    ]
  },
  {
    "name": "user_provides_comprehensive_info_upfront",
    "description": "User volunteers multiple pieces of info in one sentence",
    "user_message": "I run a sustainable fashion brand in LA called EcoWear",
    "session_context": {},
    "expected_behavior": {
      "should_extract_name": true,
      "should_extract_location": true,
      "should_extract_service_type": true,
      "should_use_google_search": true,
      "should_generate_confirmation_block": true
    },
    "expected_business_card_contains": {
      "name": "EcoWear",
      "location": "LA",
      "service_type": "sustainable fashion"
    }
  },
  {
    "name": "user_asks_clarifying_question",
    "description": "User confused about what agent is asking, seeks clarification",
    "user_message": "What do you mean by location?",
    "session_context": {
      "last_agent_message": "What's your brand name and where is your business located?"
    },
    "expected_behavior": {
      "should_provide_clarification": true,
      "should_give_location_examples": true,
      "should_not_generate_confirmation_block": true,
      "should_remain_patient_and_helpful": true
    },
    "expected_response_contains": [
      "city",
      "example"
    ]
  },
  {
    "name": "user_provides_business_name_only",
    "description": "User provides only business name, no location or other context",
    "user_message": "My business is called StyleHub",
    "session_context": {},
    "expected_behavior": {
      "should_ask_for_more_info": true,
      "should_not_generate_confirmation_block": true
    }
  },
  {
    "name": "user_provides_tiktok_handle",
    "description": "User provides TikTok handle, agent should ignore it and ask for business name (social discovery descoped)",
    "user_message": "Check out our TikTok @ecowear_official",
    "session_context": {},
    "expected_behavior": {
      "should_ask_for_business_name": true,
      "should_not_use_google_search": true
    }
  },
  {
    "name": "user_corrects_information_during_confirmation",
    "description": "User corrects details when asked for confirmation",
    "user_message": "No, the location is wrong - we're actually in San Jose, not San Francisco",
    "session_context": {
      "last_agent_message": "Business Name: TechStart\\nLocation: San Francisco, CA\\nService Type: Tech startup\\n\\nDoes everything look correct?"
    },
    "expected_behavior": {
      "should_acknowledge_correction": true,
      "should_update_location": true,
      "should_present_updated_info_for_confirmation": true,
      "should_not_generate_confirmation_block_yet": true
    },
    "expected_response_contains": [
      "San Jose"
    ]
  },
  {
    "name": "user_provides_linkedin_profile",
    "description": "User provides LinkedIn company profile URL, agent should ignore it and ask for business name",
    "user_message": "Here's our LinkedIn: linkedin.com/company/techstart-inc",
    "session_context": {},
    "expected_behavior": {
      "should_ask_for_business_name": true
    }
  },
  {
    "name": "user_provides_partial_url",
    "description": "User provides domain without https protocol",
    "user_message": "Our site is almacafe.co.il",
    "session_context": {},
    "expected_behavior": {
      "should_use_google_search": true,
      "should_construct_full_url": true,
      "should_extract_business_info": true
    }
  },
  {
    "name": "user_gives_address_instead_of_location",
    "description": "User provides full street address instead of city",
    "user_message": "We're at 123 Main Street, Suite 400, New York, NY 10001",
    "session_context": {
      "last_agent_message": "What's your brand name and where is your business located?"
    },
    "expected_behavior": {
      "should_ask_for_business_name": true
    }
  },
  {
    "name": "full_info_direct_save_happy_path",
    "description": "Tests the happy path where all required and optional fields are provided in the initial message, leading to immediate confirmation (Stage B) and saving.",
    "user_message": "My business is 'Global Solutions Inc.', we're an IT consulting firm located in Seattle, WA, and our website is globalsolutions.com.",
    "session_context": {},
    "expected_behavior": {
      "extract_all_fields": true,
      "normalize_location": true,
      "normalize_website": true,
      "perform_google_search": true,
      "display_stage_b_confirmation": true,
      "call_save_business_card": true,
      "ask_no_questions": true
    },
    "expected_response_contains": [
      "Business Name: Global Solutions Inc.",
      "Location: Seattle, WA",
      "Service Type: IT consulting firm",
      "Website: globalsolutions.com",
      "BUSINESS_CARD_CONFIRMATION",
      "Saving business card now."
    ],
    "expected_business_card": {
      "name": "Global Solutions Inc.",
      "location": "Seattle, WA",
      "service_type": "IT consulting firm",
      "website": "globalsolutions.com"
    }
  },
  {
    "name": "website_only_trigger_search_stage_a",
    "description": "Tests providing only a website URL, requiring the agent to normalize, search Google, and then present the Stage A confirmation block.",
    "user_message": "Check out our site: https://www.innovatex.io/contact",
    "session_context": {},
    "expected_behavior": {
      "extract_website": true,
      "normalize_url": true,
      "perform_google_search": true,
      "display_stage_a_confirmation": true,
      "ask_no_questions": true,
      "call_save_business_card": false
    },
    "expected_response_contains": [
      "Business Name:",
      "Location:",
      "Service Type:",
      "Website: innovatex.io",
      "Does everything look correct?"
    ],
    "expected_business_card": null
  },
  {
    "name": "name_location_search_for_service_type_then_ask",
    "description": "Tests providing name and location, requiring a Google search to find the service type. If service type is still missing, the agent should ask for it.",
    "user_message": "We are 'Green Gardens' in Portland, Oregon.",
    "session_context": {},
    "expected_behavior": {
      "extract_name": true,
      "extract_location": true,
      "normalize_location": true,
      "perform_google_search": true,
      "ask_for_missing_service_type": true,
      "display_stage_a_confirmation": false,
      "call_save_business_card": false
    },
    "expected_response_contains": [
      "What type of service does Green Gardens provide?"
    ],
    "expected_business_card": null
  },
  {
    "name": "generic_name_only_insufficient_search_ask_location",
    "description": "Tests providing only a generic business name. The agent should attempt a Google search, find it insufficient, and then ask for the location.",
    "user_message": "I own 'The Cafe'.",
    "session_context": {},
    "expected_behavior": {
      "extract_name": true,
      "perform_google_search": true,
      "ask_for_missing_location": true,
      "display_stage_a_confirmation": false,
      "call_save_business_card": false
    },
    "expected_response_contains": [
      "What's your business location?"
    ],
    "expected_business_card": null
  },
  {
    "name": "full_address_normalization_ask_name",
    "description": "Tests providing a full street address. The agent should normalize the location to City, State/Country and then ask for the business name.",
    "user_message": "Our office is at 789 Tech Lane, Suite 200, San Jose, CA 95113.",
    "session_context": {},
    "expected_behavior": {
      "extract_location": true,
      "normalize_location": true,
      "ask_for_missing_name": true,
      "display_stage_a_confirmation": false,
      "call_save_business_card": false
    },
    "expected_response_contains": [
      "What's your business name?"
    ],
    "expected_business_card": null
  },
  {
    "name": "correction_after_stage_a_reconfirm",
    "description": "Tests a correction scenario. Agent initially presents Stage A confirmation, user corrects a field, and agent updates and re-displays Stage A.",
    "user_message": "Actually, our service type is 'digital marketing solutions'.",
    "session_context": {
      "extracted_data": {
        "name": "Bright Spark",
        "location": "London, UK",
        "service_type": "marketing agency",
        "website": null
      },
      "last_agent_message": "Business Name: Bright Spark\nLocation: London, UK\nService Type: marketing agency\nWebsite: Not provided\n\nDoes everything look correct?"
    },
    "expected_behavior": {
      "update_service_type": true,
      "display_stage_a_confirmation": true,
      "call_save_business_card": false
    },
    "expected_response_contains": [
      "Business Name: Bright Spark",
      "Location: London, UK",
      "Service Type: digital marketing solutions",
      "Website: Not provided",
      "Does everything look correct?"
    ],
    "expected_business_card": null
  },
  {
    "name": "irrelevant_text_mixed_with_partial_info",
    "description": "Tests the agent's ability to ignore irrelevant text while extracting valid business information and then asking for missing fields.",
    "user_message": "Hey there! My business is 'Pet Palace', we sell pet supplies. My cat's name is Whiskers. What's next?",
    "session_context": {},
    "expected_behavior": {
      "extract_name": true,
      "extract_service_type": true,
      "ignore_irrelevant_text": true,
      "ask_for_missing_location": true,
      "display_stage_a_confirmation": false,
      "call_save_business_card": false
    },
    "expected_response_contains": [
      "What's your business location?"
    ],
    "expected_business_card": null
  },
  {
    "name": "malformed_url_normalization_then_ask",
    "description": "Tests providing a slightly malformed URL with a path and query parameters. Agent should normalize it correctly and then ask for other required fields.",
    "user_message": "Our site is www.example.com/products?id=123",
    "session_context": {},
    "expected_behavior": {
      "extract_website": true,
      "normalize_url": true,
      "ask_for_missing_name": true,
      "display_stage_a_confirmation": false,
      "call_save_business_card": false
    },
    "expected_response_contains": [
      "What's your business name?"
    ],
    "expected_business_card": null
  },
  {
    "name": "complete_fields_after_question_trigger_stage_b",
    "description": "Tests a scenario where the agent asks for a missing field, and the user provides all remaining required fields in the follow-up, triggering Stage B confirmation and saving.",
    "user_message": "We're in Berlin, Germany, and we do software development.",
    "session_context": {
      "extracted_data": {
        "name": "CodeCraft",
        "location": null,
        "service_type": null,
        "website": null
      },
      "last_agent_message": "What's your business location? (e.g., Austin, Texas, USA / London, UK / San Francisco, CA, USA)"
    },
    "expected_behavior": {
      "extract_location": true,
      "extract_service_type": true,
      "display_stage_b_confirmation": true,
      "call_save_business_card": true,
      "ask_no_questions": true
    },
    "expected_response_contains": [
      "Business Name: CodeCraft",
      "Location: Berlin, Germany",
      "Service Type: software development",
      "BUSINESS_CARD_CONFIRMATION",
      "Saving business card now."
    ],
    "expected_business_card": {
      "name": "CodeCraft",
      "location": "Berlin, Germany",
      "service_type": "software development",
      "website": null
    }
  },
  {
    "name": "provide_missing_and_correct_existing_in_one_message",
    "description": "Tests a complex scenario where the user provides a previously missing field AND corrects an already extracted field in a single follow-up message, leading to Stage B confirmation and saving.",
    "user_message": "We're in Paris, France. Actually, we're a 'gourmet pastry shop'.",
    "session_context": {
      "extracted_data": {
        "name": "Artisan Bakes",
        "location": null,
        "service_type": "bakery",
        "website": null
      },
      "last_agent_message": "What's your business location? (e.g., Austin, Texas, USA / London, UK / San Francisco, CA, USA)"
    },
    "expected_behavior": {
      "extract_location": true,
      "update_service_type": true,
      "display_stage_b_confirmation": true,
      "call_save_business_card": true,
      "ask_no_questions": true
    },
    "expected_response_contains": [
      "Business Name: Artisan Bakes",
      "Location: Paris, France",
      "Service Type: gourmet pastry shop",
      "BUSINESS_CARD_CONFIRMATION",
      "Saving business card now."
    ],
    "expected_business_card": {
      "name": "Artisan Bakes",
      "location": "Paris, France",
      "service_type": "gourmet pastry shop",
      "website": null
    }
  }
]