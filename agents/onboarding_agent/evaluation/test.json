[
  {
    "name": "user_provides_website_url",
    "description": "User provides a website URL, agent should search and extract business info",
    "user_message": "Yes, here is my website: https://www.almacafe.co.il/ourplaces/rehovot",
    "session_context": {},
    "expected_behavior": {
      "should_use_google_search": true,
      "should_extract_business_info": true,
      "should_generate_confirmation_block": true,
      "should_ask_for_confirmation": true
    },
    "expected_business_card": {
      "name": "Alma Cafe",
      "website": "https://www.almacafe.co.il/ourplaces/rehovot",
      "location": "Rehovot, Israel",
      "service_type": "Coffee shop"
    }
  },
  {
    "name": "user_provides_business_name_and_location",
    "description": "User provides business name and location, agent should search for details",
    "user_message": "My business is called TechStart and we're located in San Francisco",
    "session_context": {},
    "expected_behavior": {
      "should_use_google_search": true,
      "should_extract_business_info": true,
      "should_generate_confirmation_block": true,
      "should_ask_for_confirmation": true
    }
  },
  {
    "name": "user_confirms_business_details",
    "description": "User confirms the business details presented",
    "user_message": "Yes, that's correct!",
    "session_context": {
      "last_agent_message": "Business Name: Alma Cafe\\nLocation: Rehovot, Israel\\nService Type: Coffee shop\\n\\nDoes everything look correct?"
    },
    "expected_behavior": {
      "should_generate_confirmation_block": true,
      "should_thank_user": true
    }
  },
  {
    "name": "user_confirms_extracted_business_details_should_save",
    "description": "CRITICAL: After user confirms extracted business details, agent MUST call save_business_card tool",
    "user_message": "yes it does. how did you do it? that is great",
    "session_context": {
      "last_agent_message": "Great! I've found some details about your business. Can you take a quick look and tell me if everything here is correct for Alma Cafe?\\n\\nBusiness Name: Alma Cafe\\nLocation: Rehovot, Israel\\nService Type: Coffee shop\\nWebsite: https://www.almacafe.co.il/ourplaces/rehovot\\n\\nDoes that all look good?"
    },
    "expected_behavior": {
      "should_call_save_business_card_tool": true,
      "should_include_business_name_in_tool_call": true,
      "should_include_location_in_tool_call": true,
      "should_include_service_type_in_tool_call": true,
      "should_include_website_in_tool_call": true,
      "should_thank_user": true,
      "should_indicate_onboarding_complete": true
    },
    "expected_business_card": {
      "name": "Alma Cafe",
      "location": "Rehovot, Israel",
      "service_type": "Coffee shop",
      "website": "https://www.almacafe.co.il/ourplaces/rehovot"
    },
    "expected_tool_calls": [
      {
        "tool_name": "save_business_card",
        "parameters_contain": {
          "name": "Alma Cafe",
          "location": "Rehovot",
          "service_type": "Coffee shop",
          "website": "almacafe.co.il"
        }
      }
    ]
  },
  {
    "name": "new_user_with_minimal_info",
    "description": "New user provides minimal information, agent should ask for more",
    "user_message": "I have a local coffee shop",
    "session_context": {},
    "expected_behavior": {
      "should_ask_for_missing_info": true,
      "should_not_generate_confirmation_block": true
    }
  },
  {
    "name": "user_provides_social_media_handle",
    "description": "User provides Instagram handle, agent should ignore it and ask for business name (social discovery descoped)",
    "user_message": "My Instagram is @almacafe_rehovot",
    "session_context": {},
    "expected_behavior": {
      "should_ask_for_business_name": true,
      "should_not_use_google_search": true
    }
  },
  {
    "name": "vague_generic_question_no_context",
    "description": "User asks vague question with no business context clues",
    "user_message": "Can you help me with marketing?",
    "session_context": {},
    "expected_behavior": {
      "should_ask_for_business_name": true,
      "should_ask_for_industry_or_service_type": true,
      "should_not_generate_confirmation_block": true,
      "should_be_conversational_and_welcoming": true
    },
    "expected_response_contains": [
      "business",
      "brand"
    ]
  },
  {
    "name": "user_provides_comprehensive_info_upfront",
    "description": "User volunteers multiple pieces of info in one sentence",
    "user_message": "I run a sustainable fashion brand in LA called EcoWear",
    "session_context": {},
    "expected_behavior": {
      "should_extract_name": true,
      "should_extract_location": true,
      "should_extract_service_type": true,
      "should_use_google_search": true,
      "should_generate_confirmation_block": true
    },
    "expected_business_card_contains": {
      "name": "EcoWear",
      "location": "LA",
      "service_type": "sustainable fashion"
    }
  },
  {
    "name": "user_asks_clarifying_question",
    "description": "User confused about what agent is asking, seeks clarification",
    "user_message": "What do you mean by location?",
    "session_context": {
      "last_agent_message": "What's your brand name and where is your business located?"
    },
    "expected_behavior": {
      "should_provide_clarification": true,
      "should_give_location_examples": true,
      "should_not_generate_confirmation_block": true,
      "should_remain_patient_and_helpful": true
    },
    "expected_response_contains": [
      "city",
      "example"
    ]
  },
  {
    "name": "user_provides_business_name_only",
    "description": "User provides only business name, no location or other context",
    "user_message": "My business is called StyleHub",
    "session_context": {},
    "expected_behavior": {
      "should_ask_for_more_info": true,
      "should_not_generate_confirmation_block": true
    }
  },
  {
    "name": "user_provides_tiktok_handle",
    "description": "User provides TikTok handle, agent should ignore it and ask for business name (social discovery descoped)",
    "user_message": "Check out our TikTok @ecowear_official",
    "session_context": {},
    "expected_behavior": {
      "should_ask_for_business_name": true,
      "should_not_use_google_search": true
    }
  },
  {
    "name": "user_corrects_information_during_confirmation",
    "description": "User corrects details when asked for confirmation",
    "user_message": "No, the location is wrong - we're actually in San Jose, not San Francisco",
    "session_context": {
      "last_agent_message": "Business Name: TechStart\\nLocation: San Francisco, CA\\nService Type: Tech startup\\n\\nDoes everything look correct?"
    },
    "expected_behavior": {
      "should_acknowledge_correction": true,
      "should_update_location": true,
      "should_present_updated_info_for_confirmation": true,
      "should_not_generate_confirmation_block_yet": true
    },
    "expected_response_contains": [
      "San Jose"
    ]
  },
  {
    "name": "user_provides_linkedin_profile",
    "description": "User provides LinkedIn company profile URL, agent should ignore it and ask for business name",
    "user_message": "Here's our LinkedIn: linkedin.com/company/techstart-inc",
    "session_context": {},
    "expected_behavior": {
      "should_ask_for_business_name": true
    }
  },
  {
    "name": "user_provides_partial_url",
    "description": "User provides domain without https protocol",
    "user_message": "Our site is almacafe.co.il",
    "session_context": {},
    "expected_behavior": {
      "should_use_google_search": true,
      "should_construct_full_url": true,
      "should_extract_business_info": true
    }
  },
  {
    "name": "user_gives_address_instead_of_location",
    "description": "User provides full street address instead of city",
    "user_message": "We're at 123 Main Street, Suite 400, New York, NY 10001",
    "session_context": {
      "last_agent_message": "What's your brand name and where is your business located?"
    },
    "expected_behavior": {
      "should_ask_for_business_name": true
    }
  },
  {
    "name": "all_fields_complex_url_happy_path",
    "description": "Tests extraction of all required fields and an optional website with complex URL, including normalization, and displaying the initial review block.",
    "user_message": "My business is 'Global Connect Solutions', we are a B2B SaaS company based in San Francisco, California. Our website is https://www.globalconnectsolutions.com/contact-us/index.html",
    "session_context": {},
    "expected_behavior": {
      "should_extract_all_fields": true,
      "should_normalize_url": true,
      "should_normalize_location": true,
      "should_display_review_block": true,
      "should_not_call_save_business_card": true
    },
    "expected_response_contains": [
      "Business Name: Global Connect Solutions",
      "Location: San Francisco, CA",
      "Service Type: B2B SaaS company",
      "Website: globalconnectsolutions.com",
      "Does everything look correct?"
    ]
  },
  {
    "name": "website_only_search_then_review",
    "description": "Tests agent's ability to use `google_search` with only a website to find all required fields, then display the review block. Assumes successful search.",
    "user_message": "Check out our site: www.innovatehub.io/about",
    "session_context": {},
    "expected_behavior": {
      "should_normalize_url": true,
      "should_call_google_search_with_site_domain": true,
      "should_extract_from_search_results": true,
      "should_display_review_block": true,
      "should_not_call_save_business_card": true
    },
    "expected_response_contains": [
      "Business Name: InnovateHub",
      "Location: London, UK",
      "Service Type: Software Development",
      "Website: innovatehub.io",
      "Does everything look correct?"
    ]
  },
  {
    "name": "missing_name_initial_ask",
    "description": "Tests initial message missing business name, prompting the agent to ask for it.",
    "user_message": "We are a digital marketing agency in Sydney, Australia. Our website is digitalpros.au",
    "session_context": {},
    "expected_behavior": {
      "should_extract_partial_info": true,
      "should_ask_for_name": true,
      "should_not_call_save_business_card": true
    },
    "expected_response_contains": [
      "What's your business name?"
    ]
  },
  {
    "name": "missing_name_follow_up_confirm_save",
    "description": "Tests providing the missing name in a follow-up, leading to immediate confirmation and save (Stage B) if all other info was extracted.",
    "user_message": "It's Digital Pros",
    "session_context": {
      "extracted_name": null,
      "extracted_location": "Sydney, Australia",
      "extracted_service_type": "digital marketing agency",
      "extracted_website": "digitalpros.au",
      "last_agent_message": "What's your business name?"
    },
    "expected_behavior": {
      "should_extract_name": true,
      "should_display_confirmation_and_save": true,
      "should_call_save_business_card": true
    },
    "expected_response_contains": [
      "BUSINESS_CARD_CONFIRMATION",
      "Saving business card now."
    ],
    "expected_business_card": {
      "name": "Digital Pros",
      "location": "Sydney, Australia",
      "service_type": "digital marketing agency",
      "website": "digitalpros.au"
    }
  },
  {
    "name": "name_location_search_service_type_then_ask",
    "description": "Tests providing name and location, agent uses Google Search but `service_type` is still missing, so agent asks for it.",
    "user_message": "My company is 'Green Harvest' located in Berlin, Germany.",
    "session_context": {},
    "expected_behavior": {
      "should_extract_name_and_location": true,
      "should_call_google_search_with_name_location": true,
      "should_ask_for_service_type": true,
      "should_not_call_save_business_card": true
    },
    "expected_response_contains": [
      "What type of service does Green Harvest provide?"
    ]
  },
  {
    "name": "full_address_normalize_location_then_ask_name",
    "description": "Tests agent's ability to normalize a full street address to city, state/country, then identify missing name and ask for it.",
    "user_message": "You can find us at 789 Oak Avenue, Suite 200, Portland, Oregon 97204.",
    "session_context": {},
    "expected_behavior": {
      "should_normalize_full_address": true,
      "should_ask_for_name": true,
      "should_not_call_save_business_card": true
    },
    "expected_response_contains": [
      "What's your business name?"
    ]
  },
  {
    "name": "irrelevant_text_mixed_with_valid_info",
    "description": "Tests agent's ability to ignore irrelevant text while extracting valid business information and then display the review block.",
    "user_message": "My business, 'PetCare Pals', is in Denver, CO. My cat's name is Whiskers, by the way. We offer pet grooming services.",
    "session_context": {},
    "expected_behavior": {
      "should_extract_all_fields": true,
      "should_ignore_irrelevant_text": true,
      "should_display_review_block": true,
      "should_not_call_save_business_card": true
    },
    "expected_response_contains": [
      "Business Name: PetCare Pals",
      "Location: Denver, CO",
      "Service Type: pet grooming services",
      "Website: Not provided",
      "Does everything look correct?"
    ]
  },
  {
    "name": "correction_during_review_stage",
    "description": "Tests agent's ability to handle corrections from the user during the review stage by updating the field and re-displaying the review block.",
    "user_message": "No, the location is actually Seattle, WA, not Portland.",
    "session_context": {
      "extracted_name": "EcoWear",
      "extracted_location": "Portland, OR",
      "extracted_service_type": "Sustainable Fashion",
      "extracted_website": "ecowear.com",
      "last_agent_message": "Business Name: EcoWear\nLocation: Portland, OR\nService Type: Sustainable Fashion\nWebsite: ecowear.com\n\nDoes everything look correct?"
    },
    "expected_behavior": {
      "should_update_field": true,
      "should_redisplay_review_block": true,
      "should_not_call_save_business_card": true
    },
    "expected_response_contains": [
      "Business Name: EcoWear",
      "Location: Seattle, WA",
      "Service Type: Sustainable Fashion",
      "Website: ecowear.com",
      "Does everything look correct?"
    ]
  },
  {
    "name": "no_info_greeting_initial_ask",
    "description": "Tests agent's behavior when no business information is provided in the initial message, leading to an ask for the business name.",
    "user_message": "Hi there!",
    "session_context": {},
    "expected_behavior": {
      "should_ask_for_name": true,
      "should_not_extract_any_info": true,
      "should_not_call_save_business_card": true
    },
    "expected_response_contains": [
      "What's your business name?"
    ]
  },
  {
    "name": "google_search_insufficient_info_then_ask",
    "description": "Tests a scenario where `google_search` returns insufficient information after a name is provided, prompting the agent to ask for the next missing required field (location).",
    "user_message": "My business is 'Quantum Leap Consulting'.",
    "session_context": {},
    "expected_behavior": {
      "should_extract_name": true,
      "should_call_google_search_with_name": true,
      "should_find_google_search_insufficient": true,
      "should_ask_for_location": true,
      "should_not_call_save_business_card": true
    },
    "expected_response_contains": [
      "What's your business location?"
    ]
  }
]